{% extends "base.html" %}

{% block title %}Yeni İlan Oluştur - Ulusal Tevkil Ağı Projesi{% endblock %}

{% block content %}
<div class="px-4 md:px-10 lg:px-20 xl:px-40 flex flex-1 justify-center py-10">
    <div class="layout-content-container flex flex-col w-full max-w-[960px] flex-1">
        <div class="flex flex-wrap justify-between gap-3 p-4">
            <h1 class="text-[#111418] dark:text-white text-4xl font-black leading-tight tracking-[-0.033em] min-w-72">Yeni Tevkil İlanı Oluştur</h1>
        </div>
        
        <form method="POST" action="{{ url_for('create_post') }}" class="p-4 space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Görev Türü -->
                <label class="flex flex-col min-w-40 flex-1">
                    <p class="text-[#111418] dark:text-gray-300 text-base font-medium leading-normal pb-2">Görev Türü</p>
                    <select name="category" required class="form-select flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111418] dark:text-gray-300 dark:bg-background-dark focus:outline-0 focus:ring-0 border border-[#dcdfe5] dark:border-gray-700 bg-white focus:border-primary dark:focus:border-primary h-14 bg-no-repeat bg-right p-[15px] text-base font-normal leading-normal appearance-none">
                        <option value="" disabled selected>Görev Seçiniz</option>
                        <option value="hukuk_durusma">Hukuk Duruşması Katılım</option>
                        <option value="hukuk_durusma_tanikli">Hukuk Duruşması Katılım (Tanıklı)</option>
                        <option value="ceza_durusma">Ceza Duruşması Katılım</option>
                        <option value="icra_dairesi">İcra Dairesi İşlemleri</option>
                        <option value="haciz_muhafazasiz">Hacize Çıkma İşlemi (Muhafazasız)</option>
                        <option value="haciz_muhafazali">Hacize Çıkma İşlemi (Muhafazalı)</option>
                        <option value="savcilik_bilgi">Savcılık Bilgi Alma İşlemi</option>
                        <option value="savcilik_dosya">Savcılık Dosya Örneği/Fotokopi İşlemi</option>
                        <option value="savcilik_diger">Savcılık Diğer İşlemler</option>
                        <option value="kalem_islemleri">Kalem İşlemleri</option>
                        <option value="adliye_sorgu">Adliye Sorgu İşlemleri</option>
                        <option value="kesif">Keşife Çıkma İşlemi</option>
                        <option value="dosya_inceleme">Dosya İnceleme İşlemleri</option>
                        <option value="adliye_ifade">Adliye İfade İşlemi</option>
                        <option value="idare_vergi_durusma">İdare/Vergi Duruşması Katılım</option>
                        <option value="bam_durusma">BAM Duruşma Katılımı</option>
                        <option value="yargitay_durusma">Yargıtay Duruşma Katılımı</option>
                        <option value="diger">Diğer İşlemler</option>
                    </select>
                </label>
                
                <!-- Aciliyet Durumu -->
                <label class="flex flex-col min-w-40 flex-1">
                    <p class="text-[#111418] dark:text-gray-300 text-base font-medium leading-normal pb-2">Aciliyet Durumu</p>
                    <select name="urgency_level" required class="form-select flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111418] dark:text-gray-300 dark:bg-background-dark focus:outline-0 focus:ring-0 border border-[#dcdfe5] dark:border-gray-700 bg-white focus:border-primary dark:focus:border-primary h-14 bg-no-repeat bg-right p-[15px] text-base font-normal leading-normal appearance-none">
                        <option value="normal">Normal</option>
                        <option value="urgent">Acil</option>
                        <option value="very_urgent">Çok Acil</option>
                    </select>
                </label>
            </div>
            
            <!-- İlan Başlığı -->
            <label class="flex flex-col min-w-40 flex-1">
                <p class="text-[#111418] dark:text-gray-300 text-base font-medium leading-normal pb-2">İlan Başlığı</p>
                <input name="title" type="text" required class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111418] dark:text-gray-300 dark:bg-background-dark focus:outline-0 focus:ring-0 border border-[#dcdfe5] dark:border-gray-700 bg-white focus:border-primary dark:focus:border-primary h-14 placeholder:text-[#637188] p-[15px] text-base font-normal leading-normal" placeholder="Örn: Ankara Adliyesi'nde Duruşma Temsili"/>
            </label>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Şehir -->
                <label class="flex flex-col min-w-40 flex-1">
                    <p class="text-[#111418] dark:text-gray-300 text-base font-medium leading-normal pb-2">İl</p>
                    <select name="city" id="city" required class="form-select flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111418] dark:text-gray-300 dark:bg-background-dark focus:outline-0 focus:ring-0 border border-[#dcdfe5] dark:border-gray-700 bg-white focus:border-primary dark:focus:border-primary h-14 bg-no-repeat bg-right p-[15px] text-base font-normal leading-normal appearance-none">
                        <option value="">İl Seçiniz</option>
                        {% for city in cities %}
                        <option value="{{ city }}">{{ city }}</option>
                        {% endfor %}
                    </select>
                </label>
                
                <!-- Adliye -->
                <label class="flex flex-col min-w-40 flex-1">
                    <p class="text-[#111418] dark:text-gray-300 text-base font-medium leading-normal pb-2">Adliye</p>
                    <select name="courthouse" id="courthouse" class="form-select flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111418] dark:text-gray-300 dark:bg-background-dark focus:outline-0 focus:ring-0 border border-[#dcdfe5] dark:border-gray-700 bg-white focus:border-primary dark:focus:border-primary h-14 bg-no-repeat bg-right p-[15px] text-base font-normal leading-normal appearance-none">
                        <option value="">Önce İl Seçiniz</option>
                    </select>
                </label>
            </div>
            
            <!-- Eski konum alanı - geriye dönük uyumluluk için -->
            <input type="hidden" name="location" id="location" value="">
            <input type="hidden" name="district" id="district" value="">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Teklif Edilen Ücret (Min) -->
                <label class="flex flex-col min-w-40 flex-1">
                    <p class="text-[#111418] dark:text-gray-300 text-base font-medium leading-normal pb-2">Minimum Ücret (TL)</p>
                    <div class="relative flex w-full items-center">
                        <input name="price_min" type="number" min="0" step="100" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111418] dark:text-gray-300 dark:bg-background-dark focus:outline-0 focus:ring-0 border border-[#dcdfe5] dark:border-gray-700 bg-white focus:border-primary dark:focus:border-primary h-14 placeholder:text-[#637188] p-[15px] pr-10 text-base font-normal leading-normal" placeholder="0"/>
                        <span class="absolute right-4 text-[#637188] dark:text-gray-400">₺</span>
                    </div>
                </label>
                
                <!-- Teklif Edilen Ücret (Max) -->
                <label class="flex flex-col min-w-40 flex-1">
                    <p class="text-[#111418] dark:text-gray-300 text-base font-medium leading-normal pb-2">Maksimum Ücret (TL)</p>
                    <div class="relative flex w-full items-center">
                        <input name="price_max" type="number" min="0" step="100" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111418] dark:text-gray-300 dark:bg-background-dark focus:outline-0 focus:ring-0 border border-[#dcdfe5] dark:border-gray-700 bg-white focus:border-primary dark:focus:border-primary h-14 placeholder:text-[#637188] p-[15px] pr-10 text-base font-normal leading-normal" placeholder="0"/>
                        <span class="absolute right-4 text-[#637188] dark:text-gray-400">₺</span>
                    </div>
                </label>
            </div>
            
            <!-- Uzaktan Çalışma -->
            <div class="flex items-center gap-3">
                <input type="checkbox" name="remote_allowed" id="remote_allowed" class="h-5 w-5 rounded border-gray-300 text-primary focus:ring-primary"/>
                <label for="remote_allowed" class="text-[#111418] dark:text-gray-300 text-base font-medium leading-normal">
                    Uzaktan çalışmaya uygun (Evrak teslimi, online duruşma vb.)
                </label>
            </div>
            
            <!-- Açıklama -->
            <label class="flex flex-col min-w-40 flex-1">
                <p class="text-[#111418] dark:text-gray-300 text-base font-medium leading-normal pb-2">Görev Açıklaması</p>
                <textarea name="description" required class="form-textarea flex w-full min-w-0 flex-1 resize-y overflow-hidden rounded-lg text-[#111418] dark:text-gray-300 dark:bg-background-dark focus:outline-0 focus:ring-0 border border-[#dcdfe5] dark:border-gray-700 bg-white focus:border-primary dark:focus:border-primary min-h-[120px] placeholder:text-[#637188] p-[15px] text-base font-normal leading-normal" placeholder="Görevle ilgili detayları buraya yazabilirsiniz...&#10;&#10;Örnek:&#10;- Duruşma tarihi ve saati&#10;- Dava konusu&#10;- Yapılması gereken işlemler&#10;- Özel notlar ve dikkat edilmesi gerekenler"></textarea>
            </label>
            
            <!-- Buttons -->
            <div class="flex justify-end gap-4 pt-4">
                <a href="{{ url_for('list_posts') }}" class="px-6 py-3 rounded-lg text-primary dark:text-primary dark:hover:bg-primary/10 hover:bg-primary/10 transition-colors">
                    Vazgeç
                </a>
                <button type="submit" class="px-8 py-3 rounded-lg bg-primary text-white font-semibold hover:bg-primary/90 transition-colors">
                    İlanı Yayınla
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Dinamik adliye seçimi
document.getElementById('city').addEventListener('change', function() {
    const city = this.value;
    const courthouseSelect = document.getElementById('courthouse');
    const locationInput = document.getElementById('location');
    
    // Konum alanını güncelle (geriye dönük uyumluluk)
    locationInput.value = city;
    
    // Adliye dropdown'unu temizle
    courthouseSelect.innerHTML = '<option value="">Adliye Seçiniz</option>';
    courthouseSelect.disabled = false;
    
    if (city) {
        // API'den adliyeleri getir
        fetch(`/api/courthouses/${encodeURIComponent(city)}`)
            .then(response => response.json())
            .then(courthouses => {
                if (courthouses.length > 0) {
                    courthouses.forEach(courthouse => {
                        const option = document.createElement('option');
                        option.value = courthouse;
                        option.textContent = courthouse;
                        courthouseSelect.appendChild(option);
                    });
                } else {
                    courthouseSelect.innerHTML = '<option value="">Bu il için adliye kaydı yok</option>';
                    courthouseSelect.disabled = true;
                }
            })
            .catch(error => {
                console.error('Adliye listesi yüklenemedi:', error);
                courthouseSelect.innerHTML = '<option value="">Yükleme hatası</option>';
                courthouseSelect.disabled = true;
            });
    } else {
        courthouseSelect.innerHTML = '<option value="">Önce İl Seçiniz</option>';
        courthouseSelect.disabled = true;
    }
});

// Form gönderilmeden önce district alanını doldur
document.querySelector('form').addEventListener('submit', function() {
    const courthouse = document.getElementById('courthouse').value;
    const districtInput = document.getElementById('district');
    
    // Adliye adından ilçe çıkar (örn: "Çankaya Adliyesi" -> "Çankaya")
    if (courthouse) {
        const district = courthouse.replace(' Adliyesi', '');
        districtInput.value = district;
    }
});
</script>
{% endblock %}


